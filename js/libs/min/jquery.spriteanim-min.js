jQuery(function(e){var t=function(e,t){return"undefined"==typeof t&&(t=!0),"undefined"==typeof e?t:"true"===e.toLowerCase()||e>=1?!0:!1},i=function(t){"string"!=typeof t&&e.error("String expected.");var i=t.split("x");2!==i.length&&e.error("Should be two elements only.");var r=[];return e.each(i,function(){var t=Number(e.trim(this));isNaN(t)&&e.error(this+" is not a digit."),r.push(t)}),r},r=function(e){this.elem=e,this.initialize()};r.prototype.initialize=function(){var r={autoplay:t(e(this.elem).attr("data-autoplay"),!0),autoload:t(e(this.elem).attr("data-autoload"),!0),retina:t(e(this.elem).attr("data-retina"),!1),baseurl:e(this.elem).attr("data-baseurl"),gridsize:i(e(this.elem).attr("data-grid")),blocksize:i(e(this.elem).attr("data-blocksize")),frames:Number(e(this.elem).attr("data-frames")),fps:Number(e(this.elem).attr("data-fps")),forwards:t(e(this.elem).attr("data-forwards"),!0),curFrame:-1};(isNaN(r.fps)||r.fps<=0)&&(r.fps=12),r.baseurl||e.error("No baseurl defined."),r.gridsize||e.error("No grid size defined."),r.blocksize||e.error("No block size defined."),r.frames||e.error("No frame number defined."),(isNaN(r.frames)||r.frames<1)&&e.error("Frame number must be a positive digit."),e.extend(this,r),this.prepareElements(),r.autoload&&(this.loadSheet(),this.curFrame=this.getNextFrame(),this.showCurrentFrame()),r.autoplay&&e(this.elem).one("sheet-0-loaded",this.play.bind(this))},r.prototype.getNoSheets=function(){var e=this.gridsize[0]*this.gridsize[1];return Math.ceil(this.frames/e)},r.prototype.getCurSheetIdx=function(){var e=this.gridsize[0]*this.gridsize[1];return Math.floor(this.curFrame/e)},r.prototype.getNextSheetIdx=function(){var e=this.getCurSheetIdx(),t;if(this.forwards){var t=e+1;t>=this.getNoSheets()&&(t=0)}else{var t=e-1;0>t&&(t=this.getNoSheets()-1)}return t},r.prototype.prepareElements=function(){var t=e(this.elem);t.css({position:"relative"});for(var i=this.getNoSheets()>1?2:1,r=0;i>r;r++)t.append(e('<div class="sheet" data-idx="'+r+'">'));var s=t.children("div.sheet");s.css({position:"absolute"});var a=this.retina?.5:1;t.css({width:this.blocksize[0]*a,height:this.blocksize[1]*a,overflow:"hidden"}),this.repositionSheets()},r.prototype.repositionSheets=function(){var t=e(this.elem),i=t.children("div.sheet"),r=this.getNoSheets()>1?2:1;i.eq(this.getCurSheetIdx()%r).css({left:"0%"}),2===r&&i.eq((this.getCurSheetIdx()+1)%2).css({left:"100%"})},r.prototype.loadSheet=function(t){"undefined"==typeof t&&(t=[0,1]),Array.isArray(t)||(t=[Number(t)]);var i=this.elem;"undefined"==typeof this.loadedSheets&&(this.loadedSheets={});var r=this.loadedSheets,s=function(t){e(i).trigger("sheet-loaded",[t]),e(i).trigger("sheet-"+t+"-loaded",[t])};e.each(t,function(i,a){return"undefined"!=typeof r[a]?s(a):(r[t]=1,void e("<img>").attr("src",this.baseurl+a+".png").imageLoad(function(){s(a),r[a]=2}))}.bind(this))},r.prototype.getNextFrame=function(){var e;return this.forwards?(e=this.curFrame+1,e>=this.frames&&(e=0)):(e=this.curFrame-1,0>e&&(e=this.frames-1)),e},r.prototype.play=function(){var t=e.Event("play");e(this.elem).trigger(t),t.isDefaultPrevented()||this.doPlay()},r.prototype.doPlay=function(){var t=this;window.clearInterval(this.timer);var i=Math.round(1e3/this.fps),r=(new Date).getTime(),s=function(){var e=(new Date).getTime();return r+i>e?!1:(r=(new Date).getTime(),!0)},a=function(){if(t.mustStop)return void(t.mustStop=!1);if(requestAnimFrame(a),s()){if(!e(this.elem).parent().length)return this.stop();var i=this.getNextFrame(),r=e.Event("frame-"+i+"-show");if(e(this.elem).trigger(r),r.isDefaultPrevented())return this.stop();if(i===this.frames-1){var r=e.Event("frame-last-show");if(e(this.elem).trigger(r),r.isDefaultPrevented())return this.stop()}this.curFrame=i,this.showCurrentFrame();var r=e.Event("frame-"+i+"-shown");if(e(this.elem).trigger(r),r.isDefaultPrevented())return this.stop();if(i===this.frames-1){var r=e.Event("frame-last-shown");if(e(this.elem).trigger(r),r.isDefaultPrevented())return this.stop()}}}.bind(this);a()},r.prototype.prepareNextSheet=function(){if(this.getNextSheetIdx()!==this.getCurSheetIdx()){var t="url("+this.baseurl+this.getNextSheetIdx()+".png)",i=e(this.elem).children("div.sheet").eq((this.getCurSheetIdx()+1)%2);i.css("background-image")!==t&&i.css({"background-image":t})}},r.prototype.showCurrentFrame=function(){this.repositionSheets();var t=this.curFrame%(this.gridsize[0]*this.gridsize[1]),i=t%this.gridsize[0],r=Math.floor(t/this.gridsize[0]),s=this.retina?.5:1,a=Math.floor(i*this.blocksize[0]*s),n=Math.floor(r*this.blocksize[1]*s),o=this.getSheetDimensions(this.getCurSheetIdx()),h=e(this.elem).children("div.sheet").eq(this.getCurSheetIdx()%2),d={"background-image":"url("+this.baseurl+this.getCurSheetIdx()+".png)","background-position":-1*a+"px "+-1*n+"px","background-size":o[0]+"px "+o[1]+"px",width:this.blocksize[0],height:this.blocksize[1]};d["background-size"]===h.css("background-size")&&delete d["background-size"],-1!==h.css("background-image").search(this.baseurl+this.getCurSheetIdx()+".png")&&delete d["background-image"],d.width===h.css("width")&&delete d.width,d.height===h.css("height")&&delete d.height,h.css(d),this.prepareNextSheet()},r.prototype.stop=function(){this.mustStop=!0},r.prototype.getSheetDimensions=function(e){var t=this.gridsize[0]*this.gridsize[1],i=e*t,r=i+t;r>this.frames&&(r=this.frames);var s=this.retina?.5:1,a=r-i,n=this.blocksize[0]*a,o=0;return a>this.gridsize[0]&&(n=this.blocksize[0]*this.gridsize[0]),o=this.blocksize[1]*Math.ceil(a/this.gridsize[0]),[n*s,o*s]};var s=function(t){if(e(t).data("spriteanim"))return e(t).data("spriteanim");var i=new r(t);return e(t).data("spriteanim",i),i};e.fn.spriteanim=function(t,i){return"undefined"==typeof t&&(t="init"),e(this).each(function(){var r=s(this);switch(t){case"init":break;case"stop":r.stop(),r.timer=null;break;case"fps":r.fps=i,r.timer&&r.doPlay();break;case"play":r.play();break;case"forwards":r.forwards=i;break;default:e.error("Invalid action.")}}),this}}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),i=this,r=function(){},s=function(){return i.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,s.prototype=new r,s}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),function(e){e.ImageLoader=function(t){var i,r;return i=new Image,r=e.Deferred(function(t){var r=".ImageLoader",s;s=e.map(["readystatechange","load","abort","error"],function(e){return e+r}).join(" "),e(i).bind(s,function(i){return"readystatechange"===i.type&&"complete"!==this.readyState?!1:("abort"===i.type||"error"===i.type?t.rejectWith(this,[i]):t.resolveWith(this,[i]),e(this).unbind(r),!1)})}).promise(),r.load=function(){return i.src||(i.src=t),this},r},e.fn.imageLoad=function(t){return this.filter("img").each(function(){var i=this;i.src||e.error("imageLoad: undefined src attribute"),e.ImageLoader(i.src).load().then(function(e){t.call(i,e)},function(e){t.call(i,e)})})}}(jQuery),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();